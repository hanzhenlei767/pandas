<html>
<head>
  <title>五、Pandas库（数据整理和预处理）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307934 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1169"/>
<h1>五、Pandas库（数据整理和预处理）</h1>

<div>
<span><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">数据预处理包括：</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">1.数据清洗</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2.合并数据集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3.数据转换</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4.重塑和轴向旋转</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5.字符串操作</span></div><div><br/></div><div><br/></div><div><br/></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">1.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">数据清洗</span></font></div><div><br/></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体; line-height: 30px;">#<span style="font-size: 16pt; font-family: 楷体; line-height: 30px; color: rgb(255, 0, 0);">缺失值处理方法：</span></span></font></div><div><font face="楷体" style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体; line-height: 30px;">删除记录</span></font></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体; line-height: 30px;">数据插补（</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体; line-height: 30px;">插值法</span><span style="font-size: 16pt; font-family: 楷体; line-height: 30px;">：</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体; line-height: 30px;">拉格朗日插值法</span><span style="font-size: 16pt; font-family: 楷体; line-height: 30px;">、</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体; line-height: 30px;">牛顿插值法</span><span style="font-size: 16pt; font-family: 楷体; line-height: 30px;">）</span></font></div><div><font face="楷体" style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体; line-height: 30px;">不处理</span></font></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">数据插补方法包括</span><span style="font-size: 16pt; font-family: 楷体;">：</span></div><div><span style="font-size: 16pt;"><img src="五、Pandas库（数据整理和预处理）_files/Image.png" type="image/png" data-filename="Image.png" style="font-family: 楷体;"/></span></div><div><br/></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">拉格朗日差值：</span></div><div><span style="font-size: 16pt;"><img src="五、Pandas库（数据整理和预处理）_files/Image [1].png" type="image/png" data-filename="Image.png" style="font-family: 楷体;" width="684"/></span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">牛顿差值：</span></div><div><span style="font-size: 16pt;"><img src="五、Pandas库（数据整理和预处理）_files/Image [2].png" type="image/png" data-filename="Image.png" style="font-family: 楷体;"/></span></div><div><br/></div><div><br/></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">###</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">缺失值处理——拉格朗日插值法</span></font></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">inputfile = 'C:/Users/admin/Desktop/catering_sale.xls' #</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">销量数据路径</span></font></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">outputfile = 'C:/Users/admin/Desktop/sales.xls' #</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">输出数据路径</span></font></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">data = pd.read_excel(inputfile) #</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">读入数据</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">            日期      销量</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   2015-03-01    51.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1   2015-02-28  2618.2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2   2015-02-27  2608.4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">..         ...     ...</span></div><div><span style="font-size: 16pt; font-family: 楷体;">199 2014-08-03  3436.4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">200 2014-08-02  2261.7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[201 rows x 2 columns]</span></div><div><br/></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">过滤异常值，将其变为空值</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">data[u'销量'][(data[u'销量'] &lt; 400) | (data[u'销量'] &gt; 5000)] = None</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">            日期      销量</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   2015-03-01     NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1   2015-02-28  2618.2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2   2015-02-27  2608.4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3   2015-02-26  2651.9</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4   2015-02-25  3442.1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5   2015-02-24  3393.1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6   2015-02-23  3136.6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7   2015-02-22  3744.1</span></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">8   2015-02-21     NaN    #</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">将不符合项替换成了NaN</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">9   2015-02-20  4060.3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">10  2015-02-19  3614.7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">..         ...     ...</span></div><div><span style="font-size: 16pt; font-family: 楷体;">198 2014-08-04  2993.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">199 2014-08-03  3436.4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">200 2014-08-02  2261.7</span></div><div><br/></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">自定义列向量插值函数(拉格朗日差值的应用)</span></font></div><div><br/></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">s为列向量，n为被插值的位置，k为取前后的数据个数，默认为5</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">def ployinterp_column(s, n, k=5):</span></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">  y = s[list(range(n-k, n)) + list(range(n+1, n+1+k))] #</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">取数</span></font></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">  y = y[y.notnull()] #</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">剔除空值</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">  return</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">lagrange</span><span style="font-size: 16pt; font-family: 楷体;">(y.index, list(y))(n) #</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">插值并返回插值结果</span></div><div><br/></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">逐个元素判断是否需要插值</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">for i in data.columns:</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  for j in range(len(data)):</span></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">    if (data[i].isnull())[j]: #</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">如果为空即插值</span><span style="font-size: 16pt; font-family: 楷体;">。</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">      data[i][j] = ployinterp_column(data[i], j)</span></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">data.to_excel(outputfile) #</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">输出结果，写入文件</span></font></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">2.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">合并数据集</span></div><div><br/></div><div><span style="font-size: 16pt;"><img src="五、Pandas库（数据整理和预处理）_files/Image [3].png" type="image/png" data-filename="Image.png" style="font-family: 楷体;" width="665"/></span></div><div><br/></div><div><br/></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">DataFrame合并</span></font></div><div><br/></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">#1（两个DataFrame数据合并）</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">df1 = DataFrame({'key': ['b', 'b', 'a', 'c', 'a', 'a', 'b'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 'data1': range(7)})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df2 = DataFrame({'key': ['a', 'b', 'd'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 'data2': range(3)})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df1)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data1 key</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0      0   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1      1   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2      2   a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3      3   c</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4      4   a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5      5   a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6      6   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df2)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data2 key</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0      0   a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1      1   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2      2   d</span></div><div><br/></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">取的是两个DataFrame的交集</span></font></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">print(pd.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">merge</span><span style="font-size: 16pt; font-family: 楷体;">(df1, df2))</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">   data1 key  data2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0      0   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1      1   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2      6   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3      2   a      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4      4   a      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5      5   a      0</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">merge</span><span style="font-size: 16pt; font-family: 楷体;">(df1, df2,</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">on</span><span style="font-size: 16pt; font-family: 楷体;">='</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">key</span><span style="font-size: 16pt; font-family: 楷体;">'))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">用on参数指定键名为列名（两个DataFrame数据均有键名key）</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data1 key  data2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0      0   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1      1   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2      6   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3      2   a      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4      4   a      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5      5   a      0</span></div><div><br/></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">用参数how取两个DataFrame数据的并集</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.merge(df1, df2,</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">how</span><span style="font-size: 16pt; font-family: 楷体;">='</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">outer</span><span style="font-size: 16pt; font-family: 楷体;">'))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data1 key  data2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0    0.0   b    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1    1.0   b    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2    6.0   b    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3    2.0   a    0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4    4.0   a    0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5    5.0   a    0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6    3.0   c    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7    NaN   d    2.0</span></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">#2（指定两个键名作为列名）</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df3 = DataFrame({'lkey': ['b', 'b', 'a', 'c', 'a', 'a', 'b'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 'data1': range(7)})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df4 = DataFrame({'rkey': ['a', 'b', 'd'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 'data2': range(3)})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.merge(df3, df4,</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">left_on</span><span style="font-size: 16pt; font-family: 楷体;">='lkey',</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">right_on</span><span style="font-size: 16pt; font-family: 楷体;">='rkey'))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">指定两个键名作为列名</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data1 lkey  data2 rkey</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0      0    b      1    b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1      1    b      1    b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2      6    b      1    b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3      2    a      0    a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4      4    a      0    a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5      5    a      0    a</span></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">#3（how参数用法，以某个DataFrame为基础，求两个DataFrame的交集）</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df1 = DataFrame({'key': ['b', 'b', 'a', 'c', 'a', 'b'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 'data1': range(6)})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df2 = DataFrame({'key': ['a', 'b', 'a', 'b', 'd'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 'data2': range(5)})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df1)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data1 key</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0      0   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1      1   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2      2   a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3      3   c</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4      4   a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5      5   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df2)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data2 key</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0      0   a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1      1   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2      2   a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3      3   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4      4   d</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.merge(df1, df2, on='key',</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">how</span><span style="font-size: 16pt; font-family: 楷体;">='</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">left</span><span style="font-size: 16pt; font-family: 楷体;">'))</span><span style="font-size: 16pt; font-family: 楷体; font-weight: bold;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">以df1的列为基础取</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">两个DataFrame的交集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    data1 key  data2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0       0   b    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1       0   b    3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2       1   b    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3       1   b    3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4       2   a    0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5       2   a    2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6       3   c    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7       4   a    0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">8       4   a    2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">9       5   b    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">10      5   b    3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.merge(df1, df2, on='key',</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">how</span><span style="font-size: 16pt; font-family: 楷体;">='</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">right</span><span style="font-size: 16pt; font-family: 楷体;">'))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">以df2的列为基础取</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">两个DataFrame的交集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    data1 key  data2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0     0.0   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1     1.0   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2     5.0   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3     0.0   b      3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4     1.0   b      3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5     5.0   b      3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6     2.0   a      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7     4.0   a      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">8     2.0   a      2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">9     4.0   a      2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">10    NaN   d      4</span></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">print(pd.merge(df1, df2, how='inner'))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">取的是两个DataFrame的交集，默认how值为inner</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">   data1 key  data2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0      0   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1      0   b      3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2      1   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3      1   b      3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4      5   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5      5   b      3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6      2   a      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7      2   a      2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">8      4   a      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">9      4   a      2</span></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">#4（指定两个键值，求并）</span></div><div><span style="font-size: 16pt; font-family: 楷体;">left = DataFrame({'key1': ['foo', 'foo', 'bar'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                  'key2': ['one', 'two', 'one'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                  'lval': [1, 2, 3]})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">right = DataFrame({'key1': ['foo', 'foo', 'bar', 'bar'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                   'key2': ['one', 'one', 'one', 'two'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                   'rval': [4, 5, 6, 7]})</span></div><div><br/></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">on</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">多个键名连接，how值outer表示求并集</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.merge(left, right,</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">on</span><span style="font-size: 16pt; font-family: 楷体;">=['key1', 'key2'],</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">how</span><span style="font-size: 16pt; font-family: 楷体;">='</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">outer</span><span style="font-size: 16pt; font-family: 楷体;">'))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  key1 key2  lval  rval</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0  foo  one   1.0   4.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  foo  one   1.0   5.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2  foo  two   2.0   NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  bar  one   3.0   6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  bar  two   NaN   7.0</span></div><div><br/></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">#5（指定键名）</span></div><div><font style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体;">print(pd.merge(left, right, on='key1'))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">指定</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">键名，重复的键名也会显示出来</span></font></div><div><span style="font-size: 16pt; font-family: 楷体;">  key1</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">key2_x  </span><span style="font-size: 16pt; font-family: 楷体;">lval</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">key2_y  </span><span style="font-size: 16pt; font-family: 楷体;">rval</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0  foo    one     1    one     4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  foo    one     1    one     5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2  foo    two     2    one     4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  foo    two     2    one     5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  bar    one     3    one     6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5  bar    one     3    two     7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.merge(left, right, on='key1',</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">suffixes</span><span style="font-size: 16pt; font-family: 楷体;">=('_left', '_right')))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">指定列名的前提下，指定重复键名的列名</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  key1 key2_left  lval key2_right  rval</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0  foo       one     1        one     4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  foo       one     1        one     5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2  foo       two     2        one     4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  foo       two     2        one     5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  bar       one     3        one     6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5  bar       one     3        two     7</span></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">###</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">索引上的合并</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">left1 = DataFrame({'key': ['a', 'b', 'a', 'a', 'b', 'c'],'value': range(6)})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">right1 = DataFrame({'group_val': [3.5, 7]}, index=['a', 'b'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(left1)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  key  value</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   a      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1   b      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2   a      2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3   a      3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4   b      4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5   c      5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(right1)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   group_val</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a        3.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b        7.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.merge(left1, right1,</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">left_on</span><span style="font-size: 16pt; font-family: 楷体;">='key',</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">right_index</span><span style="font-size: 16pt; font-family: 楷体;">=True))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">以索引值为基准合并两个DataFrame数据，取交集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  key  value  group_val</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   a      0        3.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2   a      2        3.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3   a      3        3.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1   b      1        7.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4   b      4        7.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.merge(left1, right1,</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">left_on</span><span style="font-size: 16pt; font-family: 楷体;">='key',</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">right_index</span><span style="font-size: 16pt; font-family: 楷体;">=True,</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">how</span><span style="font-size: 16pt; font-family: 楷体;">='outer'))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">取并集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  key  value  group_val</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   a      0        3.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2   a      2        3.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3   a      3        3.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1   b      1        7.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4   b      4        7.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5   c      5        NaN</span></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体; line-height: 1.45;">#2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">lefth = DataFrame({'key1': ['Ohio', 'Ohio', 'Ohio', 'Nevada', 'Nevada'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                   'key2': [2000, 2001, 2002, 2001, 2002],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                   'data': np.arange(5.)})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">righth = DataFrame(np.arange(12).reshape((6, 2)),</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                   index=[['Nevada', 'Nevada', 'Ohio', 'Ohio', 'Ohio', 'Ohio'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                          [2001, 2000, 2000, 2000, 2001, 2002]],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                   columns=['event1', 'event2'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(lefth)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data    key1  key2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   0.0    Ohio  2000</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1   1.0    Ohio  2001</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2   2.0    Ohio  2002</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3   3.0  Nevada  2001</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4   4.0  Nevada  2002</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(righth)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">             event1  event2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Nevada 2001       0       1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">       2000       2       3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Ohio   2000       4       5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">       2000       6       7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">       2001       8       9</span></div><div><span style="font-size: 16pt; font-family: 楷体;">       2002      10      11</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.merge(lefth, righth, left_on=['key1', 'key2'], right_index=True))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data    key1  key2  event1  event2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   0.0    Ohio  2000       4       5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   0.0    Ohio  2000       6       7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1   1.0    Ohio  2001       8       9</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2   2.0    Ohio  2002      10      11</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3   3.0  Nevada  2001       0       1</span></div><div><span style="font-size: 16pt; font-family: 楷体; line-height: 1.45;">print(pd.merge(lefth, righth, left_on=['key1', 'key2'],right_index=True, how='outer'))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data    key1  key2  event1  event2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   0.0    Ohio  2000     4.0     5.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   0.0    Ohio  2000     6.0     7.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1   1.0    Ohio  2001     8.0     9.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2   2.0    Ohio  2002    10.0    11.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3   3.0  Nevada  2001     0.0     1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4   4.0  Nevada  2002     NaN     NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4   NaN  Nevada  2000     2.0     3.0</span></div><div><br style="font-family: 楷体; font-size: 16pt;"/></div><div><span style="font-size: 16pt; font-family: 楷体; line-height: 1.45;">left2 = DataFrame([[1., 2.], [3., 4.], [5., 6.]], index=['a', 'c', 'e'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 columns=['Ohio', 'Nevada'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">right2 = DataFrame([[7., 8.], [9., 10.], [11., 12.], [13, 14]],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                   index=['b', 'c', 'd', 'e'], columns=['Missouri', 'Alabama'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(left2)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   Ohio  Nevada</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a   1.0     2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c   3.0     4.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e   5.0     6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(right2)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   Missouri  Alabama</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b       7.0      8.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c       9.0     10.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d      11.0     12.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e      13.0     14.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">pd.merge(left2, right2, how='outer', left_index=True, right_index=True)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   Ohio  Nevada  Missouri  Alabama</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a   1.0     2.0       NaN      NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b   NaN     NaN       7.0      8.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c   3.0     4.0       9.0     10.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d   NaN     NaN      11.0     12.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e   5.0     6.0      13.0     14.0</span></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt;"><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">#3</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(left2.join(right2, how='outer'))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   Ohio  Nevada  Missouri  Alabama</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a   1.0     2.0       NaN      NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b   NaN     NaN       7.0      8.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c   3.0     4.0       9.0     10.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d   NaN     NaN      11.0     12.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e   5.0     6.0      13.0     14.0</span></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#<span style="font-size: 16pt;"><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">轴向连接</span></span></span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#1<span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">(n</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">umpy包的</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">concatenate方法)</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">arr = np.arange(12).reshape((3, 4))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(arr)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[[ 0  1  2  3]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[ 4  5  6  7]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[ 8  9 10 11]]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(np.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">concatenate</span><span style="font-size: 16pt; font-family: 楷体;">([arr, arr],</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">axis</span><span style="font-size: 16pt; font-family: 楷体;">=1))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">横向链接</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[[ 0  1  2  3  0  1  2  3]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[ 4  5  6  7  4  5  6  7]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[ 8  9 10 11  8  9 10 11]]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(np.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">concatenate</span><span style="font-size: 16pt; font-family: 楷体;">([arr, arr],</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">axis</span><span style="font-size: 16pt; font-family: 楷体;">=0))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">纵向链接</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[[ 0  1  2  3]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[ 4  5  6  7]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[ 8  9 10 11]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[ 0  1  2  3]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[ 4  5  6  7]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[ 8  9 10 11]]</span></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#<span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">2(</span></span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">pandas的concat)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">s1 = Series([0, 1], index=['a', 'b'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">s2 = Series([2, 3, 4], index=['c', 'd', 'e'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">s3 = Series([5, 6], index=['f', 'g'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat([s1, s2, s3]))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a    0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b    1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c    2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d    3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e    4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f    5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">g    6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: int64</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat([s1, s2, s3],axis = 0))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">默认纵向链接</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a    0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b    1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c    2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d    3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e    4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f    5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">g    6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: int64</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat([s1, s2, s3],axis = 1))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">横向链接</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     0    1    2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a  0.0  NaN  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b  1.0  NaN  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c  NaN  2.0  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d  NaN  3.0  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e  NaN  4.0  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f  NaN  NaN  5.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">g  NaN  NaN  6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">s4 = pd.concat([s1 * 5, s3])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(s4)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a    0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b    5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f    5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">g    6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat([s1, s4], axis=1))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">有共同元素的合并，取并</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     0  1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a  0.0  0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b  1.0  5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f  NaN  5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">g  NaN  6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat([s1, s4], axis=1, join='inner'))</span><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">有共同元素的合并，取交集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   0  1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a  0  0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b  1  5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat([s1, s4], axis=1, join_axes=[['a', 'c', 'b', 'e']]))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">可以指定行</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     0    1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a  0.0  0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c  NaN  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b  1.0  5.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e  NaN  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">result = pd.concat([s1, s1, s3], keys=['one', 'two', 'three'])#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">keys指定合并后的数据分别是来自哪个数据集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(type(result))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">&lt;class 'pandas.core.series.Series'&gt;</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(result)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">one    a    0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">       b    1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">two    a    0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">       b    1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">three  f    5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">       g    6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: int64</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(type(result.unstack()))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">&lt;class 'pandas.core.frame.DataFrame'&gt;</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(result.unstack())#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">将Series类型转换成DataFrame类型</span></div><div><span style="font-size: 16pt; font-family: 楷体;">         a    b    f    g</span></div><div><span style="font-size: 16pt; font-family: 楷体;">one    0.0  1.0  NaN  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">two    0.0  1.0  NaN  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">three  NaN  NaN  5.0  6.0</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat([s1, s2, s3],</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">axis</span><span style="font-size: 16pt; font-family: 楷体;">=1,</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">keys</span><span style="font-size: 16pt; font-family: 楷体;">=['one', 'two', 'three']))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">合并两个Series列表，</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">axis</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">按照横向合并，keys指定的是列头</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   one  two  three</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a  0.0  NaN    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b  1.0  NaN    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c  NaN  2.0    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d  NaN  3.0    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e  NaN  4.0    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f  NaN  NaN    5.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">g  NaN  NaN    6.0</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">df1 = DataFrame(np.arange(6).reshape(3, 2), index=['a', 'b', 'c'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                columns=['one', 'two'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df2 = DataFrame(5 + np.arange(4).reshape(2, 2), index=['a', 'c'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                columns=['three', 'four'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat([df1, df2], axis=1, keys=['level1', 'level2']))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">合并两个DataFrame，</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">axis横向合并，</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">keys指定列名</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  level1     level2     </span></div><div><span style="font-size: 16pt; font-family: 楷体;">     one two  three four</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a      0   1    5.0  6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b      2   3    NaN  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c      4   5    7.0  8.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat({'level1': df1, 'level2': df2}, axis=1))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">合并两个字典，可以达到合并两个DataFrame一样的效果</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  level1     level2     </span></div><div><span style="font-size: 16pt; font-family: 楷体;">     one two  three four</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a      0   1    5.0  6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b      2   3    NaN  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c      4   5    7.0  8.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat([df1, df2], axis=1, keys=['level1', 'level2'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          names=['upper', 'lower']))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">补充行表头</span></div><div><span style="font-size: 16pt; font-family: 楷体;">upper level1     level2     </span></div><div><span style="font-size: 16pt; font-family: 楷体;">lower    one two  three four</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a          0   1    5.0  6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b          2   3    NaN  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c          4   5    7.0  8.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df1 = DataFrame(np.random.randn(3, 4), columns=['a', 'b', 'c', 'd'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df2 = DataFrame(np.random.randn(2, 3), columns=['b', 'd', 'a'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df1)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          a         b         c         d</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0 -0.254839  0.906418 -0.020851  1.939965</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  1.625433 -1.159407  1.141702 -0.275564</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2 -0.950407  2.101710  0.833797 -1.742481</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df2)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          b         d         a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0  0.894856 -0.686337  0.591276</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  1.813214 -0.238694 -0.130674</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat([df1, df2]))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          a         b         c         d</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0 -0.254839  0.906418 -0.020851  1.939965</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  1.625433 -1.159407  1.141702 -0.275564</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2 -0.950407  2.101710  0.833797 -1.742481</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0  0.591276  0.894856       NaN -0.686337</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1 -0.130674  1.813214       NaN -0.238694</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.concat([df1, df2],</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">ignore_index</span><span style="font-size: 16pt; font-family: 楷体;">=True))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">ignore_index忽略掉没有用的索引</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          a         b         c         d</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0 -0.254839  0.906418 -0.020851  1.939965</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  1.625433 -1.159407  1.141702 -0.275564</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2 -0.950407  2.101710  0.833797 -1.742481</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  0.591276  0.894856       NaN -0.686337</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4 -0.130674  1.813214       NaN -0.238694</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">轴向连接（Concat的参数）</span></div><div><img src="五、Pandas库（数据整理和预处理）_files/Image [4].png" type="image/png" data-filename="Image.png" style="font-family: 楷体; font-size: 16pt;"/></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">合并重叠数据</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">Numpy:</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">where</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Series:</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">combine_first</span></div><div><span style="font-size: 16pt; font-family: 楷体;">DataFrame:<span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">combine_first</span></span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#1</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">where</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a = Series([np.nan, 2.5, np.nan, 3.5, 4.5, np.nan],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">           index=['f', 'e', 'd', 'c', 'b', 'a'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b = Series(np.arange(len(a), dtype=np.float64),</span></div><div><span style="font-size: 16pt; font-family: 楷体;">           index=['f', 'e', 'd', 'c', 'b', 'a'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b[-1] = np.nan</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(a)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e    2.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c    3.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b    4.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(b)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f    0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d    2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c    3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b    4.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a    NaN</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">如果a缺失了用b元素补上，如果a有数据，用a的。</span></div><div><span style="font-family: 楷体; font-size: 16pt;">print(np.</span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">where</span><span style="font-family: 楷体; font-size: 16pt;">(pd.isnull(a), b, a))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[ 0.   2.5  2.   3.5  4.5  nan]</span></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#2</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">Series的combine_first</span></div><div><span style="font-family: 楷体; font-size: 16pt;">print(b[:-2].</span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">combine_first</span><span style="font-family: 楷体; font-size: 16pt;">(a[2:]))</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">#b中有的用b的，没有的用a的</span></div><div><span style="font-size: 16pt; font-family: 楷体;">a    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">b    4.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">c    3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d    2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">e    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f    0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: float64</span></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#3</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">DataFrame的</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">combine_first</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df1 = DataFrame({'a': [1., np.nan, 5., np.nan],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 'b': [np.nan, 2., np.nan, 6.],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 'c': range(2, 18, 4)})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df2 = DataFrame({'a': [5., 4., np.nan, 3., 7.],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 'b': [np.nan, 3., 4., 6., 8.]})</span></div><div><span style="font-family: 楷体; font-size: 16pt;">print(df1.</span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">combine_first</span><span style="font-family: 楷体; font-size: 16pt;">(df2))#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">df1中有的用df1的，没有的用df2的</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     a    b     c</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0  1.0  NaN   2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  4.0  2.0   6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2  5.0  4.0  10.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  3.0  6.0  14.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  7.0  8.0   NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">3.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">数据转换</span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">数据转换包括：</span></div><div><span style="font-size: 16pt; font-family: 楷体;">移除重复数据</span></div><div><span style="font-size: 16pt; font-family: 楷体;">利用函数或映射进行数据转换</span></div><div><span style="font-size: 16pt; font-family: 楷体;">替换值</span></div><div><span style="font-size: 16pt; font-family: 楷体;">重命名轴索引</span></div><div><span style="font-size: 16pt; font-family: 楷体;">离散化和面元划分</span></div><div><span style="font-size: 16pt; font-family: 楷体;">检测和过滤异常值</span></div><div><span style="font-size: 16pt; font-family: 楷体;">排列和随机采样</span></div><div><span style="font-size: 16pt; font-family: 楷体;">计算指标和哑变量</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-family: 楷体; font-size: 16pt;">from <font style="color: rgb(255, 0, 0);">__future__</font> import <font style="color: rgb(255, 0, 0);">division</font></span></div><div><span style="font-family: 楷体; font-size: 16pt;">import <font style="color: rgb(250, 122, 0);">numpy</font> as <font style="color: rgb(255, 0, 0);">np</font></span></div><div><span style="font-family: 楷体; font-size: 16pt;">import <font style="color: rgb(255, 0, 0);">os</font></span></div><div><span style="font-family: 楷体; font-size: 16pt;">import <font style="color: rgb(255, 0, 0);">matplotlib.pyplot</font> as <font style="color: rgb(255, 0, 0);">plt</font></span></div><div><span style="font-family: 楷体; font-size: 16pt;">from <font style="color: rgb(255, 0, 0);">scipy.interpolate</font> import <font style="color: rgb(255, 0, 0);">lagrange</font> #导入<font style="color: rgb(255, 0, 0);">拉格朗日</font>插值函数</span></div><div><span style="font-family: 楷体; font-size: 16pt;">from <font style="color: rgb(255, 0, 0);">pandas</font> import <font style="color: rgb(255, 0, 0);">Series</font>, <font style="color: rgb(255, 0, 0);">DataFrame</font></span></div><div><span style="font-family: 楷体; font-size: 16pt;">import <font style="color: rgb(255, 0, 0);">pandas</font> as <font style="color: rgb(255, 0, 0);">pd</font></span></div><div><span style="color: rgb(255, 0, 0); font-family: 楷体; font-size: 16pt;"><br/></span></div><div><span style="color: rgb(255, 0, 0); font-family: 楷体; font-size: 16pt;">#移除重复数据</span></div><div><span style="color: rgb(255, 0, 0); font-family: 楷体; font-size: 16pt;"><br/></span></div><div><span style="color: rgb(255, 0, 0); font-family: 楷体; font-size: 16pt;"><br/></span></div><div><span style="color: rgb(255, 0, 0); font-family: 楷体; font-size: 16pt;"><br/></span></div><div><span style="font-family: 楷体; font-size: 16pt;">data = DataFrame({'k1': ['one'] * 3 + ['two'] * 4,</span></div><div><span style="font-family: 楷体; font-size: 16pt;">                  'k2': [1, 1, 2, 3, 3, 4, 4]})</span></div><div><span style="font-family: 楷体; font-size: 16pt;">print(data)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    k1  k2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0  one   1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  one   1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2  one   2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  two   3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  two   3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5  two   4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6  two   4</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-family: 楷体; font-size: 16pt;">#</span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">用pandas的duplicated判断是不是有重复数据，和前面的值比较，查看是否有重复数据</span></div><div><span style="font-family: 楷体; font-size: 16pt;">print(data.<font style="color: rgb(255, 0, 0);">duplicated</font>())</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0    False</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1     True</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2    False</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3    False</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4     True</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5    False</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6     True</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: bool</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-family: 楷体; font-size: 16pt;">#<font style="color: rgb(255, 0, 0);">用pandasd的</font><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">drop_duplicates</span></span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">丢弃重复数据</span></div><div><span style="font-family: 楷体; font-size: 16pt;">print(data.<font style="color: rgb(255, 0, 0);">drop_duplicates</font>())</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    k1  k2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0  one   1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2  one   2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  two   3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5  two   4</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">加上了v1列</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data['v1'] = range(7)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    k1  k2  v1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0  one   1   0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  one   1   1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2  one   2   2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  two   3   3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  two   3   4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5  two   4   5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6  two   4   6</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">只剔除k1列的重复数据</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data.drop_duplicates(['k1']))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    k1  k2  v1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0  one   1   0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  two   3   3</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">利用函数或映射进行数据转换</span></div><div><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data = DataFrame({'food': ['bacon', 'pulled pork', 'bacon', 'Pastrami',</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                           'corned beef', 'Bacon', 'pastrami', 'honey ham',</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                           'nova lox'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                  'ounces': [4, 3, 12, 6, 7.5, 8, 3, 5, 6]})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          food  ounces</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0        bacon     4.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  pulled pork     3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2        bacon    12.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3     Pastrami     6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  corned beef     7.5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5        Bacon     8.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6     pastrami     3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7    honey ham     5.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">8     nova lox     6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">meat_to_animal = {</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  'bacon': 'pig',</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  'pulled pork': 'pig',</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  'pastrami': 'cow',</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  'corned beef': 'cow',</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  'honey ham': 'pig',</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  'nova lox': 'salmon'</span></div><div><span style="font-size: 16pt; font-family: 楷体;">}</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">将DataFrame中food列转换成小写，然后转换成键值对，添加到data的animal列</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data['animal'] = data['food'].<font style="color: rgb(255, 0, 0);">map</font>(str.lower).<font style="color: rgb(255, 0, 0);">map</font>(meat_to_animal)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          food  ounces  animal</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0        bacon     4.0     pig</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  pulled pork     3.0     pig</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2        bacon    12.0     pig</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3     Pastrami     6.0     cow</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  corned beef     7.5     cow</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5        Bacon     8.0     pig</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6     pastrami     3.0     cow</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7    honey ham     5.0     pig</span></div><div><span style="font-size: 16pt; font-family: 楷体;">8     nova lox     6.0  salmon</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">data['food'].map(lambda x: meat_to_animal[x.lower()])#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">lambda表达式，实现同样的效果</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          food  ounces  animal</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0        bacon     4.0     pig</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  pulled pork     3.0     pig</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2        bacon    12.0     pig</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3     Pastrami     6.0     cow</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  corned beef     7.5     cow</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5        Bacon     8.0     pig</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6     pastrami     3.0     cow</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7    honey ham     5.0     pig</span></div><div><span style="font-size: 16pt; font-family: 楷体;">8     nova lox     6.0  salmon</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span> <span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">数据标准化</span></div><div><span style="font-size: 16pt; font-family: 楷体;">datafile = 'd:/data/normalization_data.xls' #<font style="color: rgb(255, 0, 0);">参数初始化</font></span></div><div><span style="font-size: 16pt; font-family: 楷体;">data = pd.<font style="color: rgb(255, 0, 0);">read_excel</font>(datafile, header = None) #<font style="color: rgb(255, 0, 0);">读取数据</font></span></div><div><span style="font-size: 16pt; font-family: 楷体;">(data - data.min())/(data.max() - data.min()) #</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">最小-最大规范化</span></div><div><span style="font-size: 16pt; font-family: 楷体;">(data - data.mean())/data.std() #</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">零-均值规范化</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data/10**np.ceil(np.log10(data.abs().max())) #</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">小数定标规范化</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><font style="color: rgb(255, 0, 0);">#替换值</font></span></div><div><span style="font-family: 楷体; font-size: 16pt; line-height: 1.45;">data = Series([1., -999., 2., -999., -1000., 3.])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0       1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1    -999.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2       2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3    -999.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4   -1000.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5       3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: float64</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#<font style="color: rgb(255, 0, 0);">单值替换</font></span></div><div><span style="font-family: 楷体; font-size: 16pt; line-height: 1.45;">print(data.</span><font style="font-family: 楷体; font-size: 16pt; line-height: 1.45; color: rgb(255, 0, 0);">replace</font><span style="font-family: 楷体; font-size: 16pt; line-height: 1.45;">(-999, np.nan))</span><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">0       1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1       NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2       2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3       NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4   -1000.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5       3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: float64</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#<font color="#FF0000">被替换值存在</font></span><span style="font-family: 楷体; font-size: 16pt; line-height: 1.45;"><font color="#FF0000">列表</font></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data.<font style="color: rgb(255, 0, 0);">replace</font>([-999, -1000], np.nan))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2    2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5    3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: float64</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#<font style="color: rgb(255, 0, 0);">被替换值和替换值分别是两个列表，一一对应</font></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data.<font style="color: rgb(255, 0, 0);">replace</font>([-999, -1000], [np.nan, 0]))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2    2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4    0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5    3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: float64</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#<font style="color: rgb(255, 0, 0);">替换值和被替换值是键值对</font></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data.replace({-999: np.nan, -1000: 0}))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2    2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4    0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5    3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: float64</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">#重命名轴索引</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data = DataFrame(np.arange(12).reshape((3, 4)),</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 index=['Ohio', 'Colorado', 'New York'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 columns=['one', 'two', 'three', 'four'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data.index.map(str.upper))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Index(['OHIO', 'COLORADO', 'NEW YORK'], dtype='object')</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data.index = data.index.map(str.upper)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          one  two  three  four</span></div><div><span style="font-size: 16pt; font-family: 楷体;">OHIO        0    1      2     3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">COLORADO    4    5      6     7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">NEW YORK    8    9     10    11</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data.<font style="color: rgb(255, 0, 0);">rename</font>(index=<font style="color: rgb(255, 0, 0);">str.title</font>, columns=<font style="color: rgb(255, 0, 0);">str.upper</font>))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          ONE  TWO  THREE  FOUR</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Ohio        0    1      2     3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Colorado    4    5      6     7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">New York    8    9     10    11</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data.<font style="color: rgb(255, 0, 0);">rename</font>(index={'OHIO': 'INDIANA'},</span></div><div><span style="font-size: 16pt; font-family: 楷体;">            columns={'three': 'peekaboo'}))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          one  two  peekaboo  four</span></div><div><span style="font-size: 16pt; font-family: 楷体;">INDIANA     0    1         2     3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">COLORADO    4    5         6     7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">NEW YORK    8    9        10    11</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">离散化与面元划分</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">ages = [20, 22, 25, 27, 21, 23, 37, 31, 61, 45, 41, 32]#<font style="color: rgb(255, 0, 0);">待范围划分的数据</font></span></div><div><span style="font-size: 16pt; font-family: 楷体;">bins = [18, 25, 35, 60, 100]#<font style="color: rgb(255, 0, 0);">数据划分的范围</font></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">cats = pd.<font style="color: rgb(255, 0, 0);">cut</font>(ages, bins)#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">左闭右开。判断ages的元素在哪个范围里</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(cats)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35, 60], (35, 60], (25, 35]]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Length: 12</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Categories (4, interval[int64]): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">print(cats.<font style="color: rgb(255, 0, 0);">labels</font>)#<font style="color: rgb(255, 0, 0);">范围段的编号</font></span></div><div><span style="font-size: 16pt; font-family: 楷体;">[0 0 0 1 0 0 2 1 3 2 2 1]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.cut(ages, [18, 26, 36, 61, 100], <font style="color: rgb(255, 0, 0);">right</font>=False))#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">左开右闭</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[[18, 26), [18, 26), [18, 26), [26, 36), [18, 26), ..., [26, 36), [61, 100), [36, 61), [36, 61), [26, 36)]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Length: 12</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Categories (4, interval[int64]): [[18, 26) &lt; [26, 36) &lt; [36, 61) &lt; [61, 100)]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">group_names = ['Youth', 'YoungAdult', 'MiddleAged', 'Senior']</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.cut(ages, bins, <font style="color: rgb(255, 0, 0);">labels</font>=group_names))#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">用labels替代范围</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[Youth, Youth, Youth, YoungAdult, Youth, ..., YoungAdult, Senior, MiddleAged, MiddleAged, YoungAdult]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Length: 12</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Categories (4, object): [Youth &lt; YoungAdult &lt; MiddleAged &lt; Senior]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">data = np.random.rand(20)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.cut(data, 4, <font style="color: rgb(255, 0, 0);">precision</font>=2))#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">将随机生成的20个数4等分</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[(0.76, 1.0], (0.29, 0.52], (0.05, 0.29], (0.29, 0.52], (0.52, 0.76], ..., (0.76, 1.0], (0.76, 1.0], (0.52, 0.76], (0.05, 0.29], (0.05, 0.29]]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Length: 20</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Categories (4, interval[float64]): [(0.05, 0.29] &lt; (0.29, 0.52] &lt; (0.52, 0.76] &lt; (0.76, 1.0]]</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-family: 楷体; font-size: 16pt; line-height: 1.45;">#2</span><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">data = np.random.randn(1000) #</span> <span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">Normally distributed正态分布</span></div><div><span style="font-size: 16pt; font-family: 楷体;">cats = pd.qcut(data, 4) #</span> <span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">Cut into quartiles等分成4组</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(cats)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[(-2.784, -0.675], (-0.00377, 0.627], (-0.675, -0.00377], (-0.00377, 0.627], (-0.00377, 0.627], ..., (-0.00377, 0.627], (0.627, 3.274], (0.627, 3.274], (-0.00377, 0.627], (-2.784, -0.675]]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Length: 1000</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Categories (4, interval[float64]): [(-2.784, -0.675] &lt; (-0.675, -0.00377] &lt; (-0.00377, 0.627] &lt; </span><span style="font-size: 16pt; font-family: 楷体; line-height: 1.45;">(0.627, 3.274]]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.value_counts(cats))#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">统计个数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">(0.645, 3.067]       250</span></div><div><span style="font-size: 16pt; font-family: 楷体;">(-0.0129, 0.645]     250</span></div><div><span style="font-size: 16pt; font-family: 楷体;">(-0.664, -0.0129]    250</span></div><div><span style="font-size: 16pt; font-family: 楷体;">(-3.337, -0.664]     250</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: int64</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.qcut(data, [0, 0.1, 0.5, 0.9, 1.]))#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">自定义分位数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[(-0.0129, 1.216], (-0.0129, 1.216], (-0.0129, 1.216], (-0.0129, 1.216], (-0.0129, 1.216], ..., (-1.285, -0.0129], (-3.337, -1.285], (-0.0129, 1.216], (-0.0129, 1.216], (-1.285, -0.0129]]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Length: 1000</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Categories (4, interval[float64]): [(-3.337, -1.285] &lt; (-1.285, -0.0129] &lt; (-0.0129, 1.216] &lt; </span><span style="font-size: 16pt; font-family: 楷体; line-height: 1.45;">(1.216, 3.067]]</span></div><div><span style="font-size: 16pt; font-family: 楷体; line-height: 1.45;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体; line-height: 1.45;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体; line-height: 1.45;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">检测和过滤异常值</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">np.random.seed(12345)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data = DataFrame(np.random.randn(1000, 4))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data.<font style="color: rgb(255, 0, 0);">describe</font>())#<font style="color: rgb(255, 0, 0);">数据描述</font></span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 0            1            2            3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">count  1000.000000  1000.000000  1000.000000  1000.000000</span></div><div><span style="font-size: 16pt; font-family: 楷体;">mean     -0.067684     0.067924     0.025598    -0.002298</span></div><div><span style="font-size: 16pt; font-family: 楷体;">std       0.998035     0.992106     1.006835     0.996794</span></div><div><span style="font-size: 16pt; font-family: 楷体;">min      -3.428254    -3.548824    -3.184377    -3.745356</span></div><div><span style="font-size: 16pt; font-family: 楷体;">25%      -0.774890    -0.591841    -0.641675    -0.644144</span></div><div><span style="font-size: 16pt; font-family: 楷体;">50%      -0.116401     0.101143     0.002073    -0.013611</span></div><div><span style="font-size: 16pt; font-family: 楷体;">75%       0.616366     0.780282     0.680391     0.654328</span></div><div><span style="font-size: 16pt; font-family: 楷体;">max       3.366626     2.653656     3.260383     3.927528</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data[(np.abs(data) &gt; 3).any(1)])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">            0         1         2         3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5   -0.539741  0.476985  3.248944 -1.021228</span></div><div><span style="font-size: 16pt; font-family: 楷体;">97  -0.774363  0.552936  0.106061  3.927528</span></div><div><span style="font-size: 16pt; font-family: 楷体;">102 -0.655054 -0.565230  3.176873  0.959533</span></div><div><span style="font-size: 16pt; font-family: 楷体;">305 -2.315555  0.457246 -0.025907 -3.399312</span></div><div><span style="font-size: 16pt; font-family: 楷体;">324  0.050188  1.951312  3.260383  0.963301</span></div><div><span style="font-size: 16pt; font-family: 楷体;">400  0.146326  0.508391 -0.196713 -3.745356</span></div><div><span style="font-size: 16pt; font-family: 楷体;">499 -0.293333 -0.242459 -3.056990  1.918403</span></div><div><span style="font-size: 16pt; font-family: 楷体;">523 -3.428254 -0.296336 -0.439938 -0.867165</span></div><div><span style="font-size: 16pt; font-family: 楷体;">586  0.275144  1.179227 -3.184377  1.369891</span></div><div><span style="font-size: 16pt; font-family: 楷体;">808 -0.362528 -3.548824  1.553205 -2.186301</span></div><div><span style="font-size: 16pt; font-family: 楷体;">900  3.366626 -2.372214  0.851010  1.332846</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data = DataFrame(np.random.randn(1000, 4))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data[np.abs(data) &gt; 3] = np.<font style="color: rgb(255, 0, 0);">sign</font>(data) * 3 #</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">sign是numpy的取符号方法</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data.describe())</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 0            1            2            3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">count  1000.000000  1000.000000  1000.000000  1000.000000</span></div><div><span style="font-size: 16pt; font-family: 楷体;">mean     -0.050960     0.000892     0.001034    -0.001492</span></div><div><span style="font-size: 16pt; font-family: 楷体;">std       0.997255     0.971675     0.971089     1.008671</span></div><div><span style="font-size: 16pt; font-family: 楷体;">min      -2.976955    -2.913619    -2.946129    -3.000000</span></div><div><span style="font-size: 16pt; font-family: 楷体;">25%      -0.771791    -0.703143    -0.641177    -0.693536</span></div><div><span style="font-size: 16pt; font-family: 楷体;">50%      -0.019709     0.051174     0.023380    -0.004173</span></div><div><span style="font-size: 16pt; font-family: 楷体;">75%       0.582686     0.663424     0.637700     0.690105</span></div><div><span style="font-size: 16pt; font-family: 楷体;">max       3.000000     3.000000     3.000000     2.909977</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">排列与随机采样</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df = DataFrame(np.arange(5 * 4).reshape((5, 4)))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    0   1   2   3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   0   1   2   3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1   4   5   6   7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2   8   9  10  11</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  12  13  14  15</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  16  17  18  19</span></div><div><span style="font-size: 16pt; font-family: 楷体;">sampler = np.random.<font style="color: rgb(255, 0, 0);">permutation</font>(5)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(sampler)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[1 2 0 3 4]</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df.<font style="color: rgb(255, 0, 0);">take</font>(sampler))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    0   1   2   3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1   4   5   6   7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2   8   9  10  11</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   0   1   2   3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  12  13  14  15</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  16  17  18  19</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df.<font style="color: rgb(255, 0, 0);">take</font>(np.random.permutation(len(df))[:3]))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    0   1   2   3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1   4   5   6   7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2   8   9  10  11</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0   0   1   2   3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  12  13  14  15</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  16  17  18  19</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">bag = np.array([5, 7, -1, 6, 4])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">sampler = np.random.<font style="color: rgb(255, 0, 0);">randint</font>(0, len(bag), size=10)#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">randint获得随机采样数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(sampler)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[2 0 0 3 0 1 3 3 0 1]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">draws = bag.<font style="color: rgb(255, 0, 0);">take</font>(sampler)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(draws)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[-1  5  5  6  5  7  6  6  5  7]</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">计算指标与哑变量</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df = DataFrame({'key': ['b', 'b', 'a', 'c', 'a', 'b'],</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                'data1': range(6)})</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data1 key</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0      0   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1      1   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2      2   a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3      3   c</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4      4   a</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5      5   b</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(pd.<font style="color: rgb(255, 0, 0);">get_dummies</font>(df['key']))#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">用数字化表示key</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   a  b  c</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0  0  1  0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1  0  1  0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2  1  0  0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3  0  0  1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4  1  0  0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5  0  1  0</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">dummies = pd.<font style="color: rgb(255, 0, 0);">get_dummies</font>(df['key'], prefix='key')#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">哑变量</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df_with_dummy = df[['data1']].join(dummies)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df_with_dummy)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">   data1  key_a  key_b  key_c</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0      0      0      1      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1      1      0      1      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">2      2      1      0      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">3      3      0      0      1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4      4      1      0      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5      5      0      1      0</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">4.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">数据重塑和轴向旋转</span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;"><br/></span></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">重塑层次化索引</span></div><div><span style="font-size: 21px; font-family: 楷体; line-height: 30px;"><span style="font-family: 楷体; font-size: 21px; line-height: 30px; color: rgb(255, 0, 0);">Stack</span>:将数据的列“旋转”为行</span></div><div><span style="font-size: 21px; font-family: 楷体; line-height: 30px;"><span style="font-family: 楷体; font-size: 21px; line-height: 30px; color: rgb(255, 0, 0);">Unstack</span>:将数据的行“旋转”为列</span></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">#1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data = DataFrame(np.arange(6).reshape((2, 3)),</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 index=pd.Index(['Ohio', 'Colorado'], name='state'),</span></div><div><span style="font-size: 16pt; font-family: 楷体;">                 columns=pd.Index(['one', 'two', 'three'], name='number'))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data)#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">DataFrame数据</span></div><div><span style="font-size: 16pt; font-family: 楷体;">number    one  two  three</span></div><div><span style="font-size: 16pt; font-family: 楷体;">state                    </span></div><div><span style="font-size: 16pt; font-family: 楷体;">Ohio        0    1      2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Colorado    3    4      5</span></div><div><br/></div><div><span style="font-family: 楷体; font-size: 16pt;">result = data.</span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">stack</span><span style="font-family: 楷体; font-size: 16pt;">()#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">转换成了Series类型，将行转换成列，列转换成行</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(type(result))</span></div><div><span style="font-family: 楷体; font-size: 16pt;">&lt;class 'pandas.core.series.</span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">Series</span><span style="font-family: 楷体; font-size: 16pt;">'&gt;</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(result)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">state     number</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Ohio      one       0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          two       1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          three     2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Colorado  one       3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          two       4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">          three     5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: int32</span></div><div><br/></div><div><span style="font-family: 楷体; font-size: 16pt;">print(result.</span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">unstack</span><span style="font-family: 楷体; font-size: 16pt;">())</span></div><div><span style="font-size: 16pt; font-family: 楷体;">number    one  two  three</span></div><div><span style="font-size: 16pt; font-family: 楷体;">state                    </span></div><div><span style="font-size: 16pt; font-family: 楷体;">Ohio        0    1      2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Colorado    3    4      5</span></div><div><br/></div><div><span style="font-family: 楷体; font-size: 16pt;">print(result.</span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">unstack</span><span style="font-family: 楷体; font-size: 16pt;">(0))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">state   Ohio  Colorado</span></div><div><span style="font-size: 16pt; font-family: 楷体;">number                </span></div><div><span style="font-size: 16pt; font-family: 楷体;">one        0         3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">two        1         4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">three      2         5</span></div><div><br/></div><div><br/></div><div><span style="font-family: 楷体; font-size: 16pt;">print(result.</span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">unstack</span><span style="font-family: 楷体; font-size: 16pt;">(&quot;state&quot;))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">state   Ohio  Colorado</span></div><div><span style="font-size: 16pt; font-family: 楷体;">number                </span></div><div><span style="font-size: 16pt; font-family: 楷体;">one        0         3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">two        1         4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">three      2         5</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">#2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">s1 = Series([0, 1, 2, 3], index=['a', 'b', 'c', 'd'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">s2 = Series([4, 5, 6], index=['c', 'd', 'e'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data2 = pd.<font style="color: rgb(255, 0, 0);">concat</font>([s1, s2], <font style="color: rgb(255, 0, 0);">keys</font>=['one', 'two'])</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data2)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">one  a    0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     b    1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     c    2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     d    3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">two  c    4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     d    5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     e    6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: int64</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">data2.<font style="color: rgb(255, 0, 0);">unstack</font>()#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">变成横向</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data2)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">       a    b    c    d    e</span></div><div><span style="font-size: 16pt; font-family: 楷体;">one  0.0  1.0  2.0  3.0  NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">two  NaN  NaN  4.0  5.0  6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: int64</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">data2.<font style="color: rgb(255, 0, 0);">unstack</font>().<font style="color: rgb(255, 0, 0);">stack</font>()#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">还原</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data2)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">one  a    0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     b    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     c    2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     d    3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">two  c    4.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     d    5.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     e    6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">data2.<font style="color: rgb(255, 0, 0);">unstack</font>().<font style="color: rgb(255, 0, 0);">stack</font>(<font style="color: rgb(255, 0, 0);">dropna</font>=False)#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">逆过程</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">保留缺失值</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(data2)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">one  a    0.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     b    1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     c    2.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     d    3.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     e    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">two  a    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     b    NaN</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     c    4.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     d    5.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">     e    6.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dtype: float64</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">#3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">df = DataFrame({'left': result, 'right': result + 5},</span></div><div><span style="font-size: 16pt; font-family: 楷体;">               columns=pd.Index(['left', 'right'], name='side'))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">side             left  right</span></div><div><span style="font-size: 16pt; font-family: 楷体;">state    number             </span></div><div><span style="font-size: 16pt; font-family: 楷体;">Ohio     one        0      5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">         two        1      6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">         three      2      7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Colorado one        3      8</span></div><div><span style="font-size: 16pt; font-family: 楷体;">         two        4      9</span></div><div><span style="font-size: 16pt; font-family: 楷体;">         three      5     10</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df.<font style="color: rgb(255, 0, 0);">unstack</font>('state'))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">side   left          right         </span></div><div><span style="font-size: 16pt; font-family: 楷体;">state  Ohio Colorado  Ohio Colorado</span></div><div><span style="font-size: 16pt; font-family: 楷体;">number                             </span></div><div><span style="font-size: 16pt; font-family: 楷体;">one       0        3     5        8</span></div><div><span style="font-size: 16pt; font-family: 楷体;">two       1        4     6        9</span></div><div><span style="font-size: 16pt; font-family: 楷体;">three     2        5     7       10</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">print(df.<font style="color: rgb(255, 0, 0);">unstack</font>('state').<font style="color: rgb(255, 0, 0);">stack</font>('side'))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">state         Colorado  Ohio</span></div><div><span style="font-size: 16pt; font-family: 楷体;">number side                 </span></div><div><span style="font-size: 16pt; font-family: 楷体;">one    left          3     0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">       right         8     5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">two    left          4     1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">       right         9     6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">three  left          5     2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">       right        10     7</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">###</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">长宽格式的转换</span></div><div><span style="font-size: 21px; color: rgb(255, 0, 0); font-family: 楷体; line-height: 30px;">长格式：</span><span style="font-size: 21px; color: rgb(255, 0, 0); font-family: 楷体; line-height: 30px;">每个变量是独立的一行</span></div><div><span style="font-size: 21px; color: rgb(255, 0, 0); font-family: 楷体; line-height: 30px;">宽格式：每个变量是独立的一列</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 